<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Warranty report document details template -->
    <template id="report_warranty_document">
        <t t-call="web.external_layout">
            <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang if doc.partner_id else 'en_US')" />
            <div class="page">
                <h2 class="mt-4 mb-4 text-center"> 
                    <span>Warranty # </span>
                    <span t-field="doc.name"/>
                </h2>
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="mb-3">Customer Details</h4>
                        <t t-if="doc.partner_id or doc.phone or doc.email">
                            <table class="table table-sm table-bordered" style="border: 1px solid black;">
                                <thead style="background-color: #f2f2f2;">
                                    <tr>
                                        <th class="text-left" style="border: 1px solid black;">Customer</th>
                                        <th class="text-left" style="border: 1px solid black;">Phone</th>
                                        <th class="text-left" style="border: 1px solid black;">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.partner_id.name"/></td>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.phone"/></td>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.email"/></td>
                                    </tr>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <p>No customer details available.</p>
                        </t>
                    </div>
                </div>
                <!-- ================= Product Details (Column Format) ================== -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="mb-3">Product Details</h4>
                        <t t-if="doc.product_id or doc.product_ref_code or doc.product_barcode or doc.serial_number or doc.qty">
                            <table class="table table-sm table-bordered" style="border: 1px solid black;">
                                <thead style="background-color: #f2f2f2;">
                                     <tr>
                                         <th class="text-left" style="border: 1px solid black;">Product</th>
                                         <th class="text-left" style="border: 1px solid black;">Product Code</th>
                                         <th class="text-left" style="border: 1px solid black;">Barcode</th>
                                         <th class="text-left" style="border: 1px solid black;">Serial Number</th>
                                         <th class="text-right" style="border: 1px solid black;">Quantity</th>
                                     </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.product_id.name"/></td>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.product_ref_code"/></td>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.product_barcode"/></td>
                                        <td class="text-left" style="border: 1px solid black;"><span t-field="doc.serial_number"/></td>
                                        <td class="text-right" style="border: 1px solid black;"><span t-field="doc.qty"/></td>
                                    </tr>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <p>No product details available.</p>
                        </t>
                    </div>
                </div>
                <!-- ================= Warranty Details (Bordered Key-Value) ================= -->
                <div class="row mb-4">
                    <div class="col-12">
                         <h4 class="mb-3">Warranty Details</h4>
                         <t t-if="doc.period or doc.duration or doc.warranty_date or doc.sale_order_id or doc.invoice_id or doc.start_date or doc.end_date or doc.renewal_cost or doc.state">
                             <table class="table table-sm table-bordered" style="border: 1px solid black;">
                                <tbody>
                                    <tr t-if="doc.period or doc.duration">
                                        <td style="width: 25%; border: 1px solid black;"><strong>Warranty Period:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.period"/> <span t-field="doc.duration"/></td>
                                    </tr>
                                    <tr t-if="doc.warranty_date">
                                        <td style="border: 1px solid black;"><strong>Warranty Date:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.warranty_date"/></td>
                                    </tr>
                                     <tr t-if="doc.start_date">
                                        <td style="border: 1px solid black;"><strong>Start Date:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.start_date"/></td>
                                    </tr>
                                    <tr t-if="doc.end_date">
                                        <td style="border: 1px solid black;"><strong>End Date:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.end_date"/></td>
                                    </tr>
                                     <tr t-if="doc.state">
                                        <td style="border: 1px solid black;"><strong>Status:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.state"/></td>
                                    </tr>
                                    <tr t-if="doc.renewal_cost">
                                        <td style="border: 1px solid black;"><strong>Renewal Cost:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.renewal_cost" t-options='{"widget": "monetary", "display_currency": doc.company_id.currency_id}'/></td>
                                    </tr>
                                    <tr t-if="doc.sale_order_id">
                                        <td style="border: 1px solid black;"><strong>Sale Order:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.sale_order_id.name"/></td>
                                    </tr>
                                    <tr t-if="doc.invoice_id">
                                        <td style="border: 1px solid black;"><strong>Invoice:</strong></td>
                                        <td style="border: 1px solid black;"><span t-field="doc.invoice_id.name"/></td>
                                    </tr>
                                </tbody>
                            </table>
                         </t>
                         <t t-else="">
                            <p>No warranty details available.</p>
                         </t>
                    </div>
                </div>
               <!-- ================= Warranty History ================= -->
                <t t-if="doc.history_ids">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h4 class="mb-3">Warranty History</h4>
                            <table class="table table-sm table-bordered" style="border: 1px solid black;">
                                <thead style="background-color: #f2f2f2;">
                                    <tr>
                                        <th class="text-left" style="border: 1px solid black;">Customer</th>
                                        <th class="text-left" style="border: 1px solid black;">Product</th>
                                        <th class="text-left" style="border: 1px solid black;">Serial Number</th>
                                        <th class="text-center" style="border: 1px solid black;">Start Date</th>
                                        <th class="text-center" style="border: 1px solid black;">End Date</th>
                                        <th class="text-right" style="border: 1px solid black;">Renew Cost</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="doc.history_ids" t-as="history_id">
                                        <tr>
                                            <td class="text-left" style="border: 1px solid black;"><span t-esc="history_id.partner_id.name"/></td>
                                            <td class="text-left" style="border: 1px solid black;"><span t-esc="history_id.product_id.name"/></td>
                                            <td class="text-left" style="border: 1px solid black;"><span t-esc="history_id.serial_number"/></td>
                                            <td class="text-center" style="border: 1px solid black;"><span t-esc="history_id.start_date" t-options='{"widget": "date"}'/></td>
                                            <td class="text-center" style="border: 1px solid black;"><span t-esc="history_id.end_date" t-options='{"widget": "date"}'/></td>
                                            <td class="text-right" style="border: 1px solid black;">
                                                <span t-esc="history_id.renewal_cost" t-options='{"widget": "monetary", "display_currency": doc.company_id.currency_id}'/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </t>
                <!-- ================= Claim Details Section ================== -->
                <t t-if="doc.claim_ids">
                    <div class="row mb-2"> 
                        <div class="col-12">
                            <h4 class="mb-3">Claim Details</h4>
                        </div>
                    </div>
                    <t t-foreach="doc.claim_ids" t-as="claim_id">
                        <div style="page-break-inside: avoid !important; margin-bottom: 1.5rem;">
                            <div class="row mb-2"> 
                                <div class="col-12">
                                    <table class="table table-sm table-bordered" style="border: 1px solid black;">
                                         <thead style="background-color: #f2f2f2;">
                                             <tr>
                                                <th class="text-left" style="border: 1px solid black;">Claim</th>
                                                <th class="text-center" style="border: 1px solid black;">Claim Date</th>
                                                <th class="text-left" style="border: 1px solid black;">Status</th>
                                                <th class="text-left" style="border: 1px solid black;">Issue</th>
                                             </tr>
                                         </thead>
                                         <tbody>
                                            <tr>
                                                <td class="text-left" style="border: 1px solid black;"><span t-field="claim_id.name"/></td>
                                                <td class="text-center" style="border: 1px solid black;"><span t-field="claim_id.date"/></td>
                                                <td class="text-left" style="border: 1px solid black;"><span t-field="claim_id.state"/></td>
                                                <td class="text-left" style="border: 1px solid black;"><span t-field="claim_id.issue"/></td>
                                            </tr>
                                         </tbody>
                                    </table>
                                </div>
                             </div>
                             <!-- Claim Parts Table  -->
                             <t t-if="claim_id.claim_warranty_parts_ids">
                                 <div class="row pl-4"> 
                                    <div class="col-12">
                                        <h4 class="mb-2">Claim Parts</h4>
                                        <table class="table table-sm table-bordered" style="border: 1px solid black; width: 90%;">
                                            <thead style="background-color: #f2f2f2;">
                                                <tr>
                                                    <th class="text-left" style="border: 1px solid black;">Product</th>
                                                    <th class="text-right" style="border: 1px solid black;">Quantity</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="claim_id.claim_warranty_parts_ids" t-as="part_id">
                                                    <tr>
                                                        <td class="text-left" style="border: 1px solid black;"><span t-esc="part_id.product_id.name"/></td>
                                                        <td class="text-right" style="border: 1px solid black;"><span t-esc="part_id.qty"/></td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                             </t>
                        </div>
                    </t>
                </t>  
            </div>
        </t>
    </template>

    <template id="sr_report_warranty">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="cp_warranty_management.report_warranty_document" t-lang="doc.partner_id.lang if doc.partner_id else 'en_US'"/>
            </t>
        </t>
    </template>
</odoo>
