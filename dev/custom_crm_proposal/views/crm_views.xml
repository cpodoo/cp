<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Oppportunity -->
    <record id="crm_lead_view_form_inherit_custom_tabs_fix" model="ir.ui.view"> 
        <field name="name">crm.lead.form.inherit.custom.tabs.fix</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="sale_crm.crm_case_form_view_oppor" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='lost_reason_id']" position="before">
                <field name="proposal_date"/>
                <field name="business_proposal_id" readonly="1"/> 
                <field name="stage_name" invisible="1"/>
                <field name="stage_sequence" invisible="1"/>
            </xpath>
            
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="category"/> 
                <field name="mou_date"/>
                <field name="mou_id" readonly="1"/>
            </xpath>

            <xpath expr="//page[@name='lead']/group/group[2]" position="inside">
                <field name="about_company"/>
            </xpath>

            <!-- Insert field below Salesperson -->
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="lead_generation_person_id" widget="many2one_avatar_user"/>
            </xpath>
            <xpath expr="//header" position="inside">
                <button name="button_generate_a_pdf"
                    string="Business Proposal"
                    type="object"
                    class="oe_highlight"
                    invisible="stage_name not in ('Proposition', 'MOU', 'Won')"
                    />
                <button name="button_generate_mou_pdf"
                    string="MOU"
                    type="object"
                    class="oe_highlight"
                    invisible="stage_name not in ('MOU', 'Won', 'Qualified Medium', 'Qualified High')"
                   />
            </xpath>
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <field name="invoice_bill_count" invisible="1"/>
                <button name="action_open_invoice_bills"
                        type="object"
                        string="Invoices"
                        class="oe_stat_button"
                        icon="fa-file-invoice-dollar">
<!--                        invisible="invoice_bill_count == 0">-->
                    <field name="invoice_bill_count" widget="statinfo" string="Invoices"/>
                </button>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="Order Lines" name="custom_order_lines">
                    <field name="custom_order_line_ids" nolabel="1">
                        <list string="Order Lines" editable="bottom">
                            <field name="product_id" required="1" context="{'partner_id': parent.partner_id}"/>
                            <field name="name" required="1" widget="text"/> 
                            <field name="product_uom_qty" required="1"/>
                            <field name="price_unit" required="1"/>
                            <field name="tax_ids" widget="many2many_tags" options="{'no_create': True}"/> 
                            <field name="currency_id" column_invisible="1"/>
                            <field name="price_subtotal" sum="Subtotal" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            <field name="price_total" sum="Total" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            <field name="display"/>
                        </list>
                    </field>
                </page>
                <!-- Deliverables Tab -->
                <page string="Deliverables" name="deliverables" invisible="stage_sequence &lt; 3">
                    <field name="deliverable_ids" nolabel="1">
                        <list string="Deliverables" editable="bottom">
                            <field name="srno"/>
                            <field name="year"/>
                            <field name="item" required="1"/>
                            <field name="description"/>
                            <field name="quantity"/>
                            <field name="uom"/>
                            <field name="display"/>
                        </list>
                    </field>
                </page>
                <!-- Payment Installments Tab -->
                <page string="Payment Installments" name="installments" invisible="stage_sequence &lt; 3">
                    <button name="create_action_invoice"
                        type="object"
                        string="Create Installment Invoice"
                        class="btn-primary"/>
                    <field name="installment_ids" nolabel="1">
                        <list string="Installments" editable="bottom">
                            <field name="year" string="Year" width="60"/>
                            <field name="installment_no" string="Installment No" required="1" width="120"/>
                            <field name="date" string="Date" width="90"/>
                            <field name="percentage" string="Percentage (%)" width="110"/>
                            <field name="currency_id" column_invisible="1"/> <!-- column_invisible isn't valid -->
                            <field name="amount" string="Installment Amount" required="1" 
                                   sum="Total Amount" widget="monetary" width="130"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="display" string="Display" width="80"/>
                        </list>
                    </field>
                </page>
                <!-- Commercials -->
                <page string="COMMERCIALS" invisible="stage_sequence &lt; 3">
                    <group>
                        <group>
                            <field name="no_of_students"/>
                            <field name="first_year_charges"/>
                            <field name="second_year_increase"/>
                            <field name="commercials_terms"/>
                        </group>
                        <group>
                            <field name="agreement_tenure"/>
                            <field name="period_type"/>
                            <field name="period_month" invisible="period_type != 'monthly'"/>
                            <field name="period_year" invisible="period_type != 'yearly'"/>
                            <field name="grade"/>
                            <field name="setup_date"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
    <!-- Lead 
    <record id="crm_lead_view_form_inherit" model="ir.ui.view">
        <field name="name">crm.lead.form.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="lead_generation_person_id" widget="many2one_avatar_user"/>
            </xpath>
        </field>
    </record>
-->
</odoo>